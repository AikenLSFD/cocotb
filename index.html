<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Cocotb : Coroutine Co-simulation Test Bench " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cocotb</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/potentialventures/cocotb">View on GitHub</a>

          <h1 id="project_title">Cocotb</h1>
          <h2 id="project_tagline">Coroutine Co-simulation Test Bench </h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/potentialventures/cocotb/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/potentialventures/cocotb/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="cocotb" class="anchor" href="#cocotb"><span class="octicon octicon-link"></span></a>Cocotb</h1>

<p><strong>cocotb</strong> is a coroutine based cosimulation library for writing VHDL and Verilog testbenches in Python.</p>

<p><strong>v0.2 pre-release now available</strong> <a href="https://github.com/potentialventures/cocotb/archive/v0.2.tar.gz">source</a></p>

<ul>
<li>Read the <a href="http://cocotb.readthedocs.org">documentation</a>
</li>
<li>Get involved: <a href="https://github.com/potentialventures/cocotb/issues/new">Raise a bug / request an enhancement</a> (Requires a GitHub account)</li>
<li>Get in contact: <a href="mailto:cocotb@potentialventures.com">E-mail us</a>
</li>
</ul><h1>
<a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>Overview</h1>

<p>VHDL and Verilog are both unsuitable for writing complex testbenches. eRM, SystemVerilog and the various SV based methodologies have emerged to address this deficiency. These verification methodologies are large and cumbersome, requiring specialist knowledge, significant time investment and expensive toolchains to achieve satisfactory verification. The overhead of setting up testbenches is onerous so often designers write small throwaway testbenches at a block level and defer the majority of verification to a large system level testbench.</p>

<p>Cocotb intends to bridge this gap in order to make block-level testing useful, reusable, fast, accessible to a much wider skill-set. The net effect is that bugs will be discovered earlier in the design cycle which equates to significant time and cost saving.</p>

<p>Cocotb is ideally suited to FPGA development but also scales to ASIC environments.  A testbench can be as simple as basic directed tests through to a complex constrained random verification environment similar to UVM but with the productivity benefit of a higher-level language.</p>

<p>Cocotb is complete <em>open-source</em>, licensed under BSD license and compatible with the <a href="http://iverilog.icarus.com/">Icarus Verilog</a> simulator.</p>

<h2>
<a name="why-verify-in-python" class="anchor" href="#why-verify-in-python"><span class="octicon octicon-link"></span></a>Why verify in Python?</h2>

<ul>
<li>It's <strong>easy</strong> to interface to other languages from Python</li>
<li>Python has a huge library of existing code to <strong>re-use</strong> like <a href="https://code.google.com/p/or-tools/">constraint solvers</a> <a href="http://www.secdev.org/projects/scapy/">packet parsing/generation</a> libraries.</li>
<li>Python is <strong>interpreted</strong>. Tests can be edited and re-run them without having to recompile the design or even exit the simulator GUI.</li>
<li>Writing Python is <strong>fast</strong>, it's <em>easy to understand</em> and <em>everybody</em> knows it.</li>
</ul><h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<p>A simplistic example of generating a clock with 10ns period:</p>

<div class="highlight"><pre><span class="nd">@cocotb.coroutine</span>
<span class="k">def</span> <span class="nf">clock</span><span class="p">(</span><span class="n">signal</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">signal</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">Timer</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">signal</span> <span class="o">&lt;=</span> <span class="mi">0</span>
        <span class="k">yield</span> <span class="n">Timer</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

<p>The python <strong>yield</strong> keyword is used to suspend the coroutine and return control back to the simulator until a condition is met. In this case, the condition is a simple timer that fires after 5ns of simulation time.</p>

<p>This may seem pretty pointless, in fact a Verilog process to perform the same operation requires fewer lines of code. Let's examine a more useful example:</p>

<div class="highlight"><pre><span class="nd">@cocotb.coroutine</span>
<span class="k">def</span> <span class="nf">pcap_replay</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">prevtime</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">packet</span> <span class="ow">in</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)):</span>
        <span class="k">yield</span> <span class="n">Timer</span><span class="p">((</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">prevtime</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">bus</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span>
</pre></div>

<p>Here we utilise a thirdparty python library called dpkt to iterate over packets in a PCAP packet capture. This becomes trivially easy in Python when compared to a VHDL/Verilog/SystemVerilog implementation. The argument "bus" is an instance of a Driver class which provides a send method to serialise the packet transaction over multiple cycles on the bus. Although the majority of the complexity is hidden in this (reusable) Driver class the actual implementation is once again straightforward:</p>

<div class="highlight"><pre><span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet</span><span class="p">):</span>

    <span class="n">words</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">RisingEdge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clk</span><span class="p">)</span>            <span class="c"># Synchronise to bus clock</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sop</span> <span class="o">&lt;=</span> <span class="mi">1</span>                         <span class="c"># First word is start-of-packet</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">&lt;=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">packet</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">word</span>
        <span class="k">yield</span> <span class="n">rising_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clk</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">sop</span> <span class="o">&lt;=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">words</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eop</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">rising_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clk</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eop</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</pre></div>

<p>For further details refer to the <a href="http://cocotb.readthedocs.org">documentation</a>.</p>

<h2>
<a name="similar-projects" class="anchor" href="#similar-projects"><span class="octicon octicon-link"></span></a>Similar projects</h2>

<p><a href="http://www.myhdl.org/">MyHDL</a> seeks to displace VHDL and Verilog with a Python framework that can generate synthesiable RTL.</p>

<p>Several examples exist of projects providing a VPI interface into a language other than C:</p>

<ul>
<li><a href="http://pyhvl.sourceforge.net/">PyHVL</a></li>
<li><a href="http://snk.tuxfamily.org/lib/ruby-vpi/">Ruby-vpi</a></li>
</ul><p>Cocotb tries to build on the advances made by these projects while learning from the direction of UVM and other verification standards.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cocotb maintained by <a href="https://github.com/potentialventures">potentialventures</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-41678571-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
